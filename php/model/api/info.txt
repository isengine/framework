Базовая инфа такая

Запрос происходит через адрес апи, например:

site.com/api/...

Язык можно указывать двумя способами:

site.com/api/ru/...
site.com/ru/api/...

и тот, и другой, считаются равноправными и одинаково управляют языком

далее

апи - это в первую очередь контроллер, и, соответственно, он должен быть целиком разработан на стороне ядра
однако, возможно также, что мы зададим базовые методы работы с апи во фреймворке
и таким образом, контроллер будет использовать модель апи, которая задана во фреймворке

далее

апи через урл распознает метод запроса таким образом:

site.com/api/class_name/method_name

Дело в том, что все методы собраны в опредленном классе. Например:

класс user содержит методы authorise, confirm, logout, register
класс system - backup, captcha, cookiesagree, write

и другие

Все методы располагаются в соответствующем пространстве имен, а именно:

is\Model\Api\Methods\class_name

При вызове апи запускается соответствующий метод из класса:

$api = new class_name;
$api -> method_name();

В метод можно передать различные параметры. Эти параметры могут быть переданы двумя способами:

через урл, например:

site.com/api/class_name/method_name/key1/value1/key2/value2/

через параметры get-запроса, например:

site.com/api/class_name/method_name?key1=value1&key2=value2

Однако

параметры запроса будут передаваться в модель апи фреймворка из контроллера апи ядра в виде массива данных
так что модель будет только вызывать класс и метод
а вот подготавливать массив данных и проверять разрешения будет контроллер

Безопасность

Чтобы обезопасить систему от вызова каких угодно методов,
во-первых, методы нужно зарегистрировать в соответствующем разделе базы данных,
а во-вторых, определенным группам пользователей можно ограничить доступ к записям в этой базе данных

Ключ

Еще один тип системного поля - пароль апи.

Этот пароль никак не шифруется, он находится в открытом виде, проверка происходит через обычное соответствие двух строк.

По нему нельзя будет залогиниться и он будет действовать только для доступа по апи.

Однако, в апи запросе будет передаваться не сам пароль, а ключ - кодированная в base64 json строка, содержащая имя пользователя и пароль апи.

Например:

{"user":"user","api":"password"}

В виде ключа:

eyJ1c2VyIjoidXNlciIsImFwaSI6InBhc3N3b3JkIn0

Когда передается ключ, он декодируется, затем ищется пользователь.
Если пользователь найден успешно, текущая сессия закрывается, новая сессия не открывается,
но при этом пользователь и база данных переинициализируются.

Такой подход сделан для того, чтобы нельзя было перехватить сессию и зайти под новым пользователем.

Токен

Токен - это кодированное в base64 время запроса, имя пользователя, ip-адрес и случайная 6-значная строка через разделители

Например:

1609448400||127.0.0.0|abcdef

В виде токена:

MTYwOTQ0ODQwMHx8MTI3LjAuMC4wfGFiY2RlZg

Токен добавляется для того, чтобы сделать запросы у разных пользователей разными.
К тому же токен защищает от CSRF-атак.
Также по токену можно валидировать запрос по его параметрам.

Защита многоуровневая:

Во-первых, токен сохраняется в сесии в двух значениях:

token-compare - старый токен, который нужен для проверки
token-request - новый токен, который будет отдаваться в запрос

Во-вторых, токен передается в запрос через заголовок






















